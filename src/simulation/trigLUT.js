import { FP } from './constants.js';

/**
 * Trigonometry Lookup Table
 * Precomputed sin/cos for 0..180 degrees in fixed-point.
 * Angle quantization is exactly 1 integer degree.
 * Tables are hardcoded for FP = 1,000,000 to ensure cross-platform determinism.
 */

const SIN_LUT = new Int32Array([0, 17452, 34899, 52336, 69756, 87156, 104528, 121869, 139173, 156434, 173648, 190809, 207912, 224951, 241922, 258819, 275637, 292372, 309017, 325568, 342020, 358368, 374607, 390731, 406737, 422618, 438371, 453990, 469472, 484810, 500000, 515038, 529919, 544639, 559193, 573576, 587785, 601815, 615661, 629320, 642788, 656059, 669131, 681998, 694658, 707107, 719340, 731354, 743145, 754710, 766044, 777146, 788011, 798636, 809017, 819152, 829038, 838671, 848048, 857167, 866025, 874620, 882948, 891007, 898794, 906308, 913545, 920505, 927184, 933580, 939693, 945519, 951057, 956305, 961262, 965926, 970296, 974370, 978148, 981627, 984808, 987688, 990268, 992546, 994522, 996195, 997564, 998630, 999391, 999848, 1000000, 999848, 999391, 998630, 997564, 996195, 994522, 992546, 990268, 987688, 984808, 981627, 978148, 974370, 970296, 965926, 961262, 956305, 951057, 945519, 939693, 933580, 927184, 920505, 913545, 906308, 898794, 891007, 882948, 874620, 866025, 857167, 848048, 838671, 829038, 819152, 809017, 798636, 788011, 777146, 766044, 754710, 743145, 731354, 719340, 707107, 694658, 681998, 669131, 656059, 642788, 629320, 615661, 601815, 587785, 573576, 559193, 544639, 529919, 515038, 500000, 484810, 469472, 453990, 438371, 422618, 406737, 390731, 374607, 358368, 342020, 325568, 309017, 292372, 275637, 258819, 241922, 224951, 207912, 190809, 173648, 156434, 139173, 121869, 104528, 87156, 69756, 52336, 34899, 17452, 0]);
const COS_LUT = new Int32Array([1000000, 999848, 999391, 998630, 997564, 996195, 994522, 992546, 990268, 987688, 984808, 981627, 978148, 974370, 970296, 965926, 961262, 956305, 951057, 945519, 939693, 933580, 927184, 920505, 913545, 906308, 898794, 891007, 882948, 874620, 866025, 857167, 848048, 838671, 829038, 819152, 809017, 798636, 788011, 777146, 766044, 754710, 743145, 731354, 719340, 707107, 694658, 681998, 669131, 656059, 642788, 629320, 615661, 601815, 587785, 573576, 559193, 544639, 529919, 515038, 500000, 484810, 469472, 453990, 438371, 422618, 406737, 390731, 374607, 358368, 342020, 325568, 309017, 292372, 275637, 258819, 241922, 224951, 207912, 190809, 173648, 156434, 139173, 121869, 104528, 87156, 69756, 52336, 34899, 17452, 0, -17452, -34899, -52336, -69756, -87156, -104528, -121869, -139173, -156434, -173648, -190809, -207912, -224951, -241922, -258819, -275637, -292372, -309017, -325568, -342020, -358368, -374607, -390731, -406737, -422618, -438371, -453990, -469472, -484810, -500000, -515038, -529919, -544639, -559193, -573576, -587785, -601815, -615661, -629320, -642788, -656059, -669131, -681998, -694658, -707107, -719340, -731354, -743145, -754710, -766044, -777146, -788011, -798636, -809017, -819152, -829038, -838671, -848048, -857167, -866025, -874620, -882948, -891007, -898794, -906308, -913545, -920505, -927184, -933580, -939693, -945519, -951057, -956305, -961262, -965926, -970296, -974370, -978148, -981627, -984808, -987688, -990268, -992546, -994522, -996195, -997564, -998630, -999391, -999848, -1000000]);

export function getSin(deg) {
    const d = Math.floor(deg) % 360;
    const absD = Math.abs(d);
    if (absD <= 180) {
        const val = SIN_LUT[absD];
        return d < 0 ? -val : val;
    } else {
        // sin(180+x) = -sin(x)
        const val = SIN_LUT[absD - 180];
        return d < 0 ? val : -val;
    }
}

export function getCos(deg) {
    const d = Math.floor(deg) % 360;
    const absD = Math.abs(d);
    if (absD <= 180) {
        return COS_LUT[absD];
    } else {
        // cos(180+x) = -cos(x)
        return -COS_LUT[absD - 180];
    }
}
