import { FP } from './constants.js';

/**
 * Trigonometry Lookup Table
 * Precomputed sin/cos for 0..360 degrees in fixed-point.
 * Precomputed atan2 for terrain slope calculation.
 */

const SIN_LUT = new Int32Array([0, 17452, 34899, 52336, 69756, 87156, 104528, 121869, 139173, 156434, 173648, 190809, 207912, 224951, 241922, 258819, 275637, 292372, 309017, 325568, 342020, 358368, 374607, 390731, 406737, 422618, 438371, 453990, 469472, 484810, 500000, 515038, 529919, 544639, 559193, 573576, 587785, 601815, 615661, 629320, 642788, 656059, 669131, 681998, 694658, 707107, 719340, 731354, 743145, 754710, 766044, 777146, 788011, 798636, 809017, 819152, 829038, 838671, 848048, 857167, 866025, 874620, 882948, 891007, 898794, 906308, 913545, 920505, 927184, 933580, 939693, 945519, 951057, 956305, 961262, 965926, 970296, 974370, 978148, 981627, 984808, 987688, 990268, 992546, 994522, 996195, 997564, 998630, 999391, 999848, 1000000]);
const COS_LUT = new Int32Array([1000000, 999848, 999391, 998630, 997564, 996195, 994522, 992546, 990268, 987688, 984808, 981627, 978148, 974370, 970296, 965926, 961262, 956305, 951057, 945519, 939693, 933580, 927184, 920505, 913545, 906308, 898794, 891007, 882948, 874620, 866025, 857167, 848048, 838671, 829038, 819152, 809017, 798636, 788011, 777146, 766044, 754710, 743145, 731354, 719340, 707107, 694658, 681998, 669131, 656059, 642788, 629320, 615661, 601815, 587785, 573576, 559193, 544639, 529919, 515038, 500000, 484810, 469472, 453990, 438371, 422618, 406737, 390731, 374607, 358368, 342020, 325568, 309017, 292372, 275637, 258819, 241922, 224951, 207912, 190809, 173648, 156434, 139173, 121869, 104528, 87156, 69756, 52336, 34899, 17452, 0]);

/**
 * ATAN2_LUT_8 for ratio y/8
 * Index: deltaY + 64 (Range -64 to 64)
 */
const ATAN2_LUT_8 = new Int8Array([
    -83, -83, -83, -83, -83, -83, -83, -83, -82, -82, -82, -82, -82, -82, -82, -81, -81, -81, -81, -81, -80, -80, -80, -80, -79, -79, -79, -78, -78, -78, -77, -77, -76, -76, -75, -75, -74, -74, -73, -72, -72, -71, -70, -69, -68, -67, -66, -65, -63, -62, -60, -59, -57, -55, -53, -51, -48, -45, -42, -38, -34, -29, -23, -14, 0, 14, 23, 29, 34, 38, 42, 45, 48, 51, 53, 55, 57, 59, 60, 62, 63, 65, 66, 67, 68, 69, 70, 71, 72, 72, 73, 74, 74, 75, 75, 76, 76, 77, 77, 78, 78, 78, 79, 79, 79, 80, 80, 80, 80, 81, 81, 81, 81, 81, 82, 82, 82, 82, 82, 82, 82, 83, 83, 83, 83, 83, 83, 83, 83
]);

export function getSin(deg) {
    const d = ((deg | 0) % 360 + 360) % 360;
    if (d <= 90) return SIN_LUT[d];
    if (d <= 180) return SIN_LUT[180 - d];
    if (d <= 270) return -SIN_LUT[d - 180];
    return -SIN_LUT[360 - d];
}

export function getCos(deg) {
    const d = ((deg | 0) % 360 + 360) % 360;
    if (d <= 90) return COS_LUT[d];
    if (d <= 180) return -COS_LUT[180 - d];
    if (d <= 270) return -COS_LUT[d - 180];
    return COS_LUT[360 - d];
}

/**
 * Specific atan2(deltaY, 8) for terrain slope.
 */
export function getAtan2(y, x) {
    if (x !== 8) return 0; // We only support x=8 for this optimized LUT
    const index = Math.max(0, Math.min(128, (y | 0) + 64));
    return ATAN2_LUT_8[index];
}
